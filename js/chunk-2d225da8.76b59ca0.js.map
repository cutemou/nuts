{"version":3,"sources":["webpack:///./src/views/Coupon.vue","webpack:///./src/components/CouponModal.vue","webpack:///./src/components/CouponModal.vue?80f5","webpack:///./src/views/Coupon.vue?43ba"],"names":["class","width","active","isLoading","type","openModal","coupons","coupon","key","id","title","code","percent","$filters","date","due_date","is_enabled","openDelCouponModal","ref","tempCoupon","updateCoupon","delCoupon","tabindex","data-bs-dismiss","aria-label","for","placeholder","true-value","false-value","$emit","data","model","props","methods","showCouponModal","this","modal","show","closeCouponModal","hide","watch","mounted","$refs","CouponModal","render","pagination","is_New","components","DelModal","isNew","couponmodal","couponModal","item","delComponent","delModal","showDeleteModal","url","$http","delete","then","res","$pushMessageState","success","hideDeleteModal","getCoupon","page","get","convertToUnixTimestamp","httpMethod","dateTime","Date","getTime","timestamp","Math","floor","openCouponDeleteModal","couponDeleteModal","showCouponDeleteModal","created"],"mappings":"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","file":"js/chunk-2d225da8.76b59ca0.js","sourcesContent":["// 後台優惠卷頁面\r\n<template>\r\n <div>\r\n  <Loading :active=\"isLoading\"></Loading>\r\n    <div class=\"text-end\">\r\n        <button class=\"btn btn-success mt-4\" type=\"button\" @click=\"openModal(true)\">新增優惠卷</button>\r\n    </div>\r\n    <table class=\"table mt-4\">\r\n        <thead>\r\n            <tr>\r\n            <th width=\"120\">名稱</th>\r\n            <th width=\"120\">優惠碼</th>\r\n            <th width=\"120\">折扣百分比</th>\r\n            <th width=\"120\">到期日</th>\r\n            <th width=\"120\">是否啟用</th>\r\n            <th width=\"200\">編輯</th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            <tr v-for=\"coupon in coupons\" :key=\"coupon.id\">\r\n            <td>{{coupon.title}}</td>\r\n            <td>{{coupon.code}}</td>\r\n            <td>{{coupon.percent}}%</td>\r\n            <td class=\"text-right\">\r\n                {{$filters.date(coupon.due_date)}}\r\n            </td>\r\n            <td>\r\n                <span class=\"text-success\" v-if=\"coupon.is_enabled\">啟用</span>\r\n                <span class=\"text-muted\" v-else>未啟用</span>\r\n            </td>\r\n            <td>\r\n                <div class=\"btn-group\">\r\n                <button class=\"btn btn-outline-primary btn-sm\" @click=\"openModal(false, coupon)\">編輯</button>\r\n                <button class=\"btn btn-outline-danger btn-sm\" @click=\"openDelCouponModal(coupon)\">刪除</button>\r\n                </div>\r\n            </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n    <CouponModal ref=\"couponModal\" :coupon=\"tempCoupon\" @update-coupon=\"updateCoupon\"></CouponModal>\r\n    <DelModal :coupon=\"tempCoupon\" ref=\"delModal\" @delete-something=\"delCoupon\"></DelModal>\r\n </div>\r\n</template>\r\n\r\n<script>\r\nimport CouponModal from '../components/CouponModal.vue'\r\nimport DelModal from '@/components/DeleteModal.vue'\r\nexport default {\r\n  data () {\r\n    return {\r\n      coupons: {}, // 存取取得的優惠卷\r\n      tempCoupon: {}, // 透過props傳送給couponmodal\r\n      pagination: {}, // 存取api傳遞的分頁數\r\n      isLoading: '',\r\n      is_New: false // 用來判斷是新增還是編輯\r\n    }\r\n  },\r\n  components: {\r\n    CouponModal,\r\n    DelModal\r\n  },\r\n  methods: {\r\n    openModal (isNew, coupon) {\r\n      if (isNew) {\r\n        this.tempCoupon = {}\r\n      } else {\r\n        coupon.due_date = this.$filters.date(coupon.due_date)\r\n        this.tempCoupon = { ...coupon }\r\n      }\r\n      const couponmodal = this.$refs.couponModal\r\n      couponmodal.showCouponModal()\r\n    },\r\n    openDelCouponModal (item) {\r\n      this.tempCoupon = { ...item }\r\n      const delComponent = this.$refs.delModal\r\n      delComponent.showDeleteModal()\r\n    },\r\n    delCoupon () {\r\n      const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/order/${this.tempCoupon.id}`\r\n      this.isLoading = true\r\n      this.$http.delete(url).then((res) => {\r\n        this.$pushMessageState(res, '優惠卷刪除')\r\n        if (res.data.success) {\r\n          const delComponent = this.$refs.delModal\r\n          delComponent.hideDeleteModal()\r\n          this.getCoupon()\r\n        }\r\n      })\r\n    },\r\n    getCoupon (page = 1) {\r\n      this.isLoading = true\r\n      const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons/?page=${page}`\r\n      this.$http.get(url)\r\n        .then((res) => {\r\n          this.coupons = res.data.coupons\r\n          this.pagination = res.data.pagination\r\n          this.isLoading = false\r\n        })\r\n    },\r\n    updateCoupon (coupon) {\r\n      this.isLoading = true\r\n      this.tempCoupon = coupon\r\n      this.convertToUnixTimestamp()\r\n      const couponModal = this.$refs.couponModal\r\n      // 新增\r\n      let url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`\r\n      let httpMethod = 'post'\r\n      // 編輯\r\n      if (!this.is_New) {\r\n        url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${coupon.id}`\r\n        httpMethod = 'put'\r\n      }\r\n      this.$http[httpMethod](url, { data: this.tempCoupon })\r\n        .then((res) => {\r\n          this.$pushMessageState(res, '優惠卷更新')\r\n          if (res.data.success) {\r\n            couponModal.closeCouponModal()\r\n            this.isLoading = false\r\n            this.getCoupon()\r\n          }\r\n        })\r\n    },\r\n    // 將輸入的日期轉換為UnixTimestamp，並存入tempCoupon後給api驗證\r\n    convertToUnixTimestamp () {\r\n      const dateTime = +new Date(this.tempCoupon.due_date).getTime()\r\n      const timestamp = Math.floor(dateTime / 1000)\r\n      this.tempCoupon.due_date = timestamp\r\n    },\r\n    openCouponDeleteModal (coupon) {\r\n      this.tempCoupon = coupon\r\n      const couponDeleteModal = this.$refs.couponDeleteModal\r\n      couponDeleteModal.showCouponDeleteModal()\r\n    }\r\n  },\r\n  created () {\r\n    this.getCoupon()\r\n  }\r\n}\r\n</script>\r\n","// 後台建立、更新優惠卷modal\r\n<template>\r\n  <div class=\"modal\" tabindex=\"-1\" ref=\"CouponModal\">\r\n    <div class=\"modal-dialog\">\r\n      <div class=\"modal-content\">\r\n        <div class=\"modal-header bg-success\">\r\n          <h5 class=\"modal-title text-white\">新增優惠卷</h5>\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn-close\"\r\n            data-bs-dismiss=\"modal\"\r\n            aria-label=\"Close\"\r\n          ></button>\r\n        </div>\r\n        <div class=\"modal-body\">\r\n            <div class=\"row gx-2\">\r\n                <div class=\"mb-3 col-md-6\">\r\n                <label for=\"title\" class=\"form-label\">名稱</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"title\"\r\n                        placeholder=\"請輸入名稱\" v-model=\"tempCoupon.title\">\r\n                </div>\r\n                <div class=\"mb-3 col-md-6\">\r\n                <label for=\"code\" class=\"form-label\">優惠碼</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"code\"\r\n                placeholder=\"請輸入優惠碼\" v-model=\"tempCoupon.code\">\r\n                </div>\r\n            </div>\r\n            <div class=\"mb-3\">\r\n                <label for=\"percent\" class=\"form-label\">折扣百分比</label>\r\n                <input type=\"number\" class=\"form-control\" id=\"percent\"\r\n                placeholder=\"請輸入折扣百分比(%)\" v-model.number=\"tempCoupon.percent\">\r\n            </div>\r\n            <div class=\"mb-3\">\r\n                <label for=\"due_date\" class=\"form-label\">到期日</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"due_date\"\r\n                        placeholder=\"請輸入到期日 ex:2012/04/12\" v-model=\"tempCoupon.due_date\">\r\n            </div>\r\n            <div class=\"mb-3\">\r\n                <div class=\"form-check\">\r\n                <input class=\"form-check-input\" type=\"checkbox\"\r\n                        :true-value=\"1\"\r\n                        :false-value=\"0\"\r\n                        id=\"is_enabled\"\r\n                        v-model=\"tempCoupon.is_enabled\">\r\n                <label class=\"form-check-label\" for=\"is_enabled\">\r\n                    是否啟用\r\n                </label>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"modal-footer\">\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn btn-secondary\"\r\n\r\n            data-bs-dismiss=\"modal\"\r\n          >\r\n            取消\r\n          </button>\r\n          <button type=\"button\" class=\"btn btn-success\" @click=\"$emit('updateCoupon', this.tempCoupon)\">確認新增</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Modal from 'bootstrap/js/dist/modal'\r\nexport default {\r\n  data () {\r\n    return {\r\n      model: {}, // modal實體\r\n      tempCoupon: {} // 接收props\r\n    }\r\n  },\r\n  props: ['coupon'],\r\n  methods: {\r\n    showCouponModal () {\r\n      this.modal.show()\r\n    },\r\n    closeCouponModal () {\r\n      this.modal.hide()\r\n    }\r\n  },\r\n  watch: {\r\n    coupon () {\r\n      this.tempCoupon = this.coupon\r\n    }\r\n  },\r\n  mounted () {\r\n    this.modal = new Modal(this.$refs.CouponModal)\r\n  }\r\n}\r\n</script>\r\n","import { render } from \"./CouponModal.vue?vue&type=template&id=09ac4264\"\nimport script from \"./CouponModal.vue?vue&type=script&lang=js\"\nexport * from \"./CouponModal.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./Coupon.vue?vue&type=template&id=04bb2838\"\nimport script from \"./Coupon.vue?vue&type=script&lang=js\"\nexport * from \"./Coupon.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}